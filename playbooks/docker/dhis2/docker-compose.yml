version: '3'
services:
  dhis2:
    image: blsq/dhis2:2.34.8
    restart: always
    volumes:
      - dhis2_files:/root/files
    expose:
      - "8080"
    ports:
      - 8080:8080
    environment:
      - DHIS_BASE_URL=https://${DOMAIN_NAME}
      - DATABASE_USER=${DATABASE_USER}
      - DATABASE_PASSWORD=${DATABASE_PASSWORD}
      - DATABASE_NAME=${DATABASE_NAME}
      - DATABASE_HOST=${DATABASE_HOST}
    labels:
      - 'traefik.enable=true'
      - 'traefik.docker.network=proxy'

      - 'traefik.http.routers.dhis2.entrypoints=websecure'
      - 'traefik.http.routers.dhis2.middlewares=no-auth-secured@file'
      - 'traefik.http.routers.dhis2.rule=Host(`${DOMAIN_NAME}`)'
      - 'traefik.http.routers.dhis2.tls.certresolver=lets-encrypt'
      - 'traefik.http.routers.dhis2.tls.options=mintls12@file'

      - "traefik.http.services.dhis2.loadbalancer.passhostheader=true"

volumes:
  dhis2_files: